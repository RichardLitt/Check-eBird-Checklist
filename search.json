[
  {
    "objectID": "check-ebird-checklist.html",
    "href": "check-ebird-checklist.html",
    "title": "Check eBird Checklist",
    "section": "",
    "text": "library(tidyverse)\nlibrary(auk)\nlibrary(DT)\nlibrary(ggplot2)\nlibrary(writexl)\nlibrary(glue)"
  },
  {
    "objectID": "check-ebird-checklist.html#introduction",
    "href": "check-ebird-checklist.html#introduction",
    "title": "Check eBird Checklist",
    "section": "Introduction",
    "text": "Introduction\nAccording to the eBird Volunteer Roles and Expectations, eBird checklist reviewers are responsible for tagging eBird Checklists as Public or Not Public, following eBird standards:\n\n\nEvaluate entire eBird checklists to verify that checklist location, date, protocol, and other details are accurate. \nEnsure that distance and duration are not excessively long for the situation and that checklists do not otherwise violate eBird data quality guidelines—holding observers to a uniform standard as outlined in the eBird Central guidelines. \nWhen checklists marked Not Public could be improved and displayed publicly, inform the checklist owner of the necessary changes that would make their list(s) appropriate for public display.\nWork with eBird Observation Reviewers and eBird Mentors when checklist-level data quality raises concerns about an observer’s eBird understanding, willingness, or ability to contribute useful data for eBird.\nMaintain comprehensive understanding of eBird checklist review policies and follow those standards in the review process.\n\n\nThese responsibilities can be difficult to implement in practice as there is no tool to identify checklists violating eBird data quality guidelines. Below, we propose a series of checks that can be performed to identify these checklists using the eBird Basic Dataset (EBD)."
  },
  {
    "objectID": "check-ebird-checklist.html#how-to-review-checklists",
    "href": "check-ebird-checklist.html#how-to-review-checklists",
    "title": "Check eBird Checklist",
    "section": "How to review checklists",
    "text": "How to review checklists\nDetailed explanations on how to review checklists are provided in the eBird Reviewer Handbook:\n\n\nChecklist-Date Imprecise: Use this when an observer submits records from a correct location, but uses a date that is clearly incorrect. Some users submit lists spanning multiple days. eBird does not accept multi-day lists and it is best to make these checklists Not Public using this reason, even if they are otherwise correct. Obvious list-building efforts should be invalidated as Checklist-List Building and incorrectly plotted locations should be made Not Public using one of the Location review reasons below.\nChecklist-Distance Too Long: Mainland checklists of 80.5 km (50.0 miles) or longer, or High Seas checklists (https://ebird.org/region/XX) of 160.9 km (100.0 miles) or longer, are automatically tagged as Checklist-Distance Too Long. Reviewers can override this in rare cases, and if observers correct a typo (e.g., change 50 miles to 5.0 miles) then the checklist can be marked Public by a reviewer; editing the distance does not reverse the automatic tagging.\nOne goal of review is to ensure that correctly identified records are plotted reasonably accurately, so that display on a map will not misrepresent the species’ range. In general, we believe that most checklists of 8 km (5 miles) or less should be accepted by reviewers and most checklists of 25 km (15 miles) or more should probably be marked Checklist-Distance Too Long, especially if they span multiple habitats. Reviewers must use their best judgment in all cases to not be overly restrictive, but to also steer observers towards shorter and more precise lists.\nChecklist-Error: This reason is to be used for miscellaneous issues with the checklist that are not covered by the other review reasons (one example would be a checklist reporting entirely captive birds from a zoo). This reason should almost always be accompanied by review notes explaining why the checklist was considered Not Public.\nChecklist-List Building: It is common for observers to create a life list or a state list by plotting a location or selecting a random point, picking a random date, and submitting a full list of what they’ve seen over the course of a lifetime or a trip to a given country or state. These do not represent serious attempts to submit data worthy of a scientific database, so these should be made Not Public. Records from these often are easily caught by our filters, and anytime these are identified the entire list should be marked Not Public with this reason. Note that we do formally recommend that users submit such lists using the date of 1 Jan 1900 (see the Enter your pre- eBird life list article) and records from this date are automatically tagged as Checklist-List Building and marked Not Public. If you encounter users entering different dates for such lists, please steer them to this article.\nChecklist-Multi-party: eBird is a system for collecting single-party checklists. If two or more observers go birding independently, these birding efforts should be submitted separately. If they are not, it is appropriate to make the list Not Public using this reason if the observer is unwilling to correct his or her list. Christmas Bird Count “sector” data is sometimes submitted this way as an aggregation from multiple independent parties, and this is the appropriate way to address those checklists.\nChecklist-Protocol Error: This reason is to be used when eBirders use protocols incorrectly. These could include custom protocols, like atlases or specialized surveys, or misuse of Traveling Count or Stationary count protocols. Also, Nocturnal flight call counts should use the special protocol since this makes assumptions about counts and detectability that do not affect eBird output. Please ask observers to change their Nocturnal Flight Call count submissions to this protocol; if they do not, marking them Not Public using this reason may be appropriate. Changing protocol does not automatically remove this tag, so this requires a reviewer.\nLocation-Issue: This review reason is to be used for any case where the observer has badly misplotted the location or has selected the incorrect location. Ideally, the reviewer would email the observer in such cases to inform him or her about the error. Note that use of country, state/province, or county-level locations (from “Submit for an entire country, state, county, or city”) will automatically treat checklists as Not Public using the appropriate review reason. For any Location review reason—including both reviewer-tagged checklists and automatically- tagged checklists—a correction of the location by the user (either a location move or selection of a different location) will remove this checklist-level flag. We assume in such cases that the observer has made the appropriate correction and if not, these will need to be located again; we do not give reviewer notification in such cases."
  },
  {
    "objectID": "check-ebird-checklist.html#read-ebd-database",
    "href": "check-ebird-checklist.html#read-ebd-database",
    "title": "Check eBird Checklist",
    "section": "Read EBD database",
    "text": "Read EBD database\nTo perform the checks below, start by downloading the EBD file for your region on eBird.\n\n\n\n\n\n\nNote\n\n\n\nDownloading the EBD requires to submit a data request.\n\n\n\n# file &lt;- \"data/ebd_KE_relAug-2022/ebd_KE_relAug-2022.txt\"\n# file &lt;- \"data/ebd_US-AL-101_202204_202204_relApr-2022_SAMPLE/ebd_US-AL-101_202204_202204_relApr-2022.txt\"\nfile &lt;- \"data/ebd_CH_smp_relAug-2023/ebd_CH_smp_relAug-2023.txt\"\n\nRead data with the R auk package.\n\nobs_0 &lt;- read_ebd(file)\n\n\n\n\n\n\n\nTip\n\n\n\nIn case this operation takes too much time, an alternative is to split the database on region/subregion or year.\n\nobs_0 &lt;- auk_ebd(file) %&gt;% \n  # auk_country(\"Kenya\") %&gt;% \n  # auk_state(\"KE-300\") %&gt;% \n  # auk_county(\"KE-300\") %&gt;% \n  auk_year(seq(2010,2020)) %&gt;% \n  # auk_date(date = c(\"2020-05-01\", \"2020-06-30\"))\n  # auk_complete() %&gt;%  # Only complete checklists\n  auk_filter(file = tempfile()) %&gt;% \n  read_ebd()\n\nTo find a country, state or county, use the Explore regions search on eBird and use the code in the URL. Alternatively, you can also use the variable ebird_states in the auk package to list all countries and states."
  },
  {
    "objectID": "check-ebird-checklist.html#process-database-to-checklists",
    "href": "check-ebird-checklist.html#process-database-to-checklists",
    "title": "Check eBird Checklist",
    "section": "Process database to checklists",
    "text": "Process database to checklists\nNext, build the observation and checklist database.\n\nobs &lt;- obs_0 %&gt;%\n  mutate(\n    group_id = checklist_id,\n    checklist_id = sampling_event_identifier\n  ) %&gt;%\n  select(c(\n    \"group_id\", \"checklist_id\", \"taxonomic_order\", \"common_name\", \"observation_count\",\n    \"locality\", \"observation_date\", \"time_observations_started\", \"observer_id\",\n    \"protocol_type\", \"duration_minutes\", \"effort_distance_km\", \"number_observers\",\n    \"all_species_reported\", \"has_media\"))\n\n# Build checklist database\nc &lt;- obs %&gt;%\n  mutate(\n    observation_count_num = as.numeric(ifelse(observation_count == \"X\", NA, observation_count))\n  ) %&gt;% \n  group_by(group_id) %&gt;%\n  mutate(\n    number_species = n(),\n    number_distinct_count = n_distinct(observation_count),\n    median_count = median(observation_count_num, na.rm = T),\n    number_media = sum(has_media)\n  ) %&gt;%\n  ungroup() %&gt;%\n  select(-c(group_id, taxonomic_order, common_name, observation_count, observation_count_num, has_media)) %&gt;%\n  unique()\n\n# Modify some columns for ease of use\nc &lt;- c %&gt;%\n  mutate(\n    observation_date = ymd(observation_date),\n    time_observations_started = hms(time_observations_started, quiet = T),\n    checklist_link = paste0(\"&lt;a href='https://ebird.org/checklist/\", str_extract(checklist_id, \"^[^,]+\"), \"' target='_blank'&gt;\", checklist_id, \"&lt;/a&gt;\"),\n    all_species_reported = all_species_reported & protocol_type != \"Incidental\"\n  )"
  },
  {
    "objectID": "check-ebird-checklist.html#explore-your-data",
    "href": "check-ebird-checklist.html#explore-your-data",
    "title": "Check eBird Checklist",
    "section": "Explore your data",
    "text": "Explore your data\nHere are some figures to get an overview of the checklists meta-data distribution. You might be able to already see some outliers/issues.\n\nDurationDistanceNumber of observersTime of startProtocol typeNumber of speciesNumber of species per distanceNumber of species per time\n\n\n\nc %&gt;% filter(!is.na(duration_minutes)) %&gt;% \n  ggplot(aes(x=duration_minutes/60)) +\n  geom_histogram(binwidth=15/60)\n\n\n\n\n\n\n\nc %&gt;% filter(!is.na(effort_distance_km)) %&gt;% \n  ggplot(aes(x=effort_distance_km)) +\n  geom_histogram(binwidth=1)\n\n\n\n\n\n\n\nc %&gt;% filter(!is.na(number_observers)) %&gt;% \n  ggplot(aes(x=number_observers)) +\n  geom_histogram(binwidth=1)\n\n\n\n\n\n\n\nc %&gt;% filter(!is.na(time_observations_started)) %&gt;% \n  ggplot(aes(x=as.numeric(time_observations_started, units=\"hours\"))) +\n  geom_histogram(binwidth = 1)\n\n\n\n\n\n\n\nc %&gt;% \n  ggplot(aes(y=protocol_type)) +\n  geom_bar() +\n  scale_x_log10()\n\n\n\n\n\n\n\nc %&gt;% filter(!is.na(number_species)) %&gt;% \n  ggplot(aes(x=number_species)) +\n  geom_histogram(binwidth=1)\n\n\n\n\n\n\n\nc %&gt;% filter(all_species_reported & protocol_type== \"Traveling\") %&gt;% \n  ggplot(aes(x=effort_distance_km, y=number_species)) +\n  geom_point(aes(col=log(duration_minutes))) +\n  geom_smooth(method=\"gam\", formula = y ~ s(x, bs = \"cs\"))\n\n\n\n\n\n\n\nc %&gt;% filter(all_species_reported & duration_minutes&lt;12*60) %&gt;% \n  ggplot(aes(x=duration_minutes/60, y=number_species)) +\n  geom_point() +\n  geom_smooth(method=\"gam\", formula = y ~ s(x, bs = \"cs\"))"
  },
  {
    "objectID": "check-ebird-checklist.html#checks",
    "href": "check-ebird-checklist.html#checks",
    "title": "Check eBird Checklist",
    "section": "Checks",
    "text": "Checks\nThe core idea of this guide is to identify checklists which might have an issue based on a series of checks.\n\n\n\n\n\n\nImportant\n\n\n\nIt is essential that you manually adapt the value of the parameters used here to see if they make sense for your reviewing region. You might start with more permissive value at first and then reduce them later to catch more problematic checklists.\n\n\n\nchk_ampm (Error): A frequent issue is for the time to be entered as AM instead of PM (i.e., in the middle of the night, rather than in the afternoon).\nchk_midnight (Error): Starting a checklist at midnight should be quite uncommon, but it’s often used by people to enter day-list or incorrectly add time on a historical/incidental list without time.\nchk_multi_day (Protocol Error): Checklists that span over two days are not valid.\nchk_not_traveling (Protocol Error): Traveling checklists of less than 30m should be entered as stationary.\nchk_not_stationary (Protocol Error): Staionary checklists with more than xx species are most likely traveling checklists.\nchk_high_number_species (List Building or Date Imprecise): Checklists with an exceptionally high number of species (relative to your region) are generally indicative of multi-day lists or list-building.\nchk_only_one_species (Protocol Error): A complete checklist with a single species is often indicative of incorrectly checking the “Complete” button.\nchk_too_long_distance (Distance Too Long): As mentioned in the guidelines, a checklist of more than xx km is susceptible to be distance too long.\nchk_too_short_duration (Protocol Error): Checklists with a high number of species relative to the duration are suspicious.\nchk_too_fast (Protocol Error): Catch protocol issues with incoherent duration and distance\nchk_complete_media (Protocol Error): Checklists marked as complete with a media for each species often tend to rather be “Incomplete” checklists.\nchk_too_many_observers (Protocol Error): Checklists with more than xx observers are often suspicious.\nchk_specialized_protocol (Protocol Error): You might want to check the use of non-standard protocols.\n\n\nchk &lt;- c %&gt;% \n  mutate(\n    chk_ampm = (time_observations_started &gt; hm(\"22:00\") | time_observations_started &lt; hm(\"4:00\")) & \n      (time_observations_started + minutes(duration_minutes) &lt; hm(\"6:00\")) & \n      number_species &gt; 10,\n    chk_midnight = time_observations_started == hms(\"00:00:00\"),\n    chk_high_number_species = number_species&gt;90,\n    chk_only_one_species = all_species_reported & number_species==1 & duration_minutes &gt; 5,\n    chk_same_count_all_species = all_species_reported & median_count&gt;0 & number_distinct_count==1 & number_species&gt;2,\n    chk_too_long_distance = effort_distance_km &gt; 25,\n    chk_multi_day = time_observations_started + minutes(duration_minutes) &gt; hours(24),\n    chk_too_many_observers = number_observers &gt; 30,\n    chk_too_short_duration = all_species_reported & number_species/duration_minutes &gt; 10,\n    chk_too_fast = effort_distance_km/duration_minutes*60 &gt; 60,\n    chk_complete_media = all_species_reported & number_media==number_species,\n    chk_not_stationary = protocol_type == \"Stationary\" & number_species&gt;50,\n    chk_specialized_protocol = !(protocol_type %in% c(\"Historical\", \"Traveling\", \"Incidental\", \"Stationary\")),\n    chk_not_traveling = protocol_type==\"Traveling\" & effort_distance_km &lt; 0.03\n  ) %&gt;% \n  mutate(across(starts_with(\"chk_\"), ~replace_na(., FALSE)))\n\n\nCheck overview\nIn the table below you can view the number of checklists flagged for each check.\n\nchk %&gt;% \n  select(., starts_with(\"chk_\")) %&gt;% \n  summarise(across(everything(), sum)) %&gt;% \n  pivot_longer(everything(), names_to = \"Check\", values_to = \"number_checklist\") %&gt;% \n  arrange(desc(number_checklist)) %&gt;% \n  datatable(options = list( pageLength =  50)  )\n\n\n\n\n\n\nThe matrix below highlights the number of checklists flagged by two checks. We want to limit these as far as possible, but some overlap is unavoidable.\n\ndf &lt;-  chk %&gt;% \n  select(., starts_with(\"chk_\"))\n\n# Compute the matrix\nco_occurrence_matrix &lt;- t(as.matrix(df)) %*% as.matrix(df)\n\n# Hide the lower right part of the matrix (symetric)\ndiag(co_occurrence_matrix) &lt;- NA\nco_occurrence_matrix[lower.tri(co_occurrence_matrix, diag = TRUE)] &lt;- NA\n\nas.data.frame(as.table(co_occurrence_matrix)) %&gt;% \n  ggplot(aes(x = Var1, y = Var2)) +\n  geom_tile(aes(fill = Freq), color = \"white\") +\n  scale_fill_gradient(low = \"white\", high = \"blue\") +\n  geom_text(aes(label = Freq), position = position_dodge(width = 0.5), vjust = 0.5, hjust = 0.5, size = 3) +\n  theme_minimal() +\n  labs(fill = \"Co-occurrence\", x = \"Check\", y = \"Check\") +\n  coord_fixed()  +  # ensures the tiles are square\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\n\n\n\nFor each check (edit the check name in the code below), you can also view the checklists flagged by eobserver.\n\nchk %&gt;% \n  filter(chk_too_long_distance) %&gt;% \n  # filter(rowSums(select(., starts_with(\"chk_\"))) &gt; 0) %&gt;% \n  # filter(observer_id==\"obsr497615\") %&gt;% \n  group_by(observer_id) %&gt;% \n  arrange(desc(effort_distance_km)) %&gt;% \n  summarise(checklist_link = toString(checklist_link), number_checklist = n()) %&gt;% \n  # arrange(desc(number_checklist)) %&gt;% \n  datatable(escape = FALSE)\n\n\n\n\n\n\n\n\nExport\nTo facilitate managing such a high number of checklists and keep track of your review progress, export the checklists as a spreadsheet using the code below.\n\nwrite_xlsx(chk,\"data/export_ebd_checklist_checked.xlsx\")"
  },
  {
    "objectID": "check-ebird-checklist.html#email-templates",
    "href": "check-ebird-checklist.html#email-templates",
    "title": "Check eBird Checklist",
    "section": "Email templates",
    "text": "Email templates\nBelow we provide suggested text for emailing users tailored for each check.\n\n\n\n\n\n\nImportant\n\n\n\nThe objectives of emailing users is to (1) make them aware of this error and avoid them reproducing such errors in the future and (2) get them to correct their checklist.\n\n\n\ntemplate &lt;- list(\n  a =\"\nDear [name],\n\nThank you for being a part of eBird. To help make sure that eBird can be used for scientific research and conservation, volunteers like me follow up on unusual observations as a part of the eBird data quality process.\n\",\n  checklist = \"\nI am writing about the following checklist(s): {checklists_link}\n\",\n  z = \"\nCould you please check these checklists, and make any potential corrections. Let me know when you're done, so that I can set the checklist as public again.\n\nThanks in advance,\n\nRaphaël Nussbaumer\n\",\n  ampm = \"\nYour checklist(s) was flagged because it has an unusual start time, with a potential confusion between AM and PM. If no start time is available, the checklist protocol should be &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols#anchorHistorical\\\"&gt;historical&lt;/a&gt; if birding was your &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000967748-birding-as-your-primary-purpose-and-complete-checklists\\\"&gt;primary purpose&lt;/a&gt; or &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols#anchorIncidental\\\"&gt;incidental&lt;/a&gt; if birding was not your primary purpose. In both cases, you can leave the time field empty. \n\",\n  ampm_midnight = \"\nYour checklist(s) was flagged because it is unusual to start a checklist at exactly midnight. If no start time is available, the checklist protocol should be &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols#anchorHistorical\\\"&gt;historical&lt;/a&gt; if birding was your &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000967748-birding-as-your-primary-purpose-and-complete-checklists\\\"&gt;primary purpose&lt;/a&gt; or &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols#anchorIncidental\\\"&gt;incidental&lt;/a&gt; if birding was not your primary purpose. In both cases, you can leave the time field empty. \n\",\nhigh_number_species = \"\nYour checklist(s) was flagged because it contains an unusually high number of species. We want to double check with you that the checklist follows &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000795623-ebird-rules-and-best-practices\\\"&gt;eBird rules and best practices&lt;/a&gt;, in particular:\n- Correspond to a single calendar date: checklists should not span multiple\ndays. &lt;b&gt;Were all species seen/heard from the start time of your checklist up to the duration set in your checklist?&lt;/b&gt;\n- Correspond to a single map location: birds from different map regions should not be combined on one list. &lt;b&gt;Were all species reported seen/heard within the distance set in your checklist, centered around the location of the checklist?&lt;/b&gt; \n- Correspond to the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols\\\"&gt;appropriate protocol&lt;/a&gt;.\n\",\ntoo_long_distance = \"\nYour checklist(s) was flagged because it as an usually high distance. While it is acceptable to make a checklist of up to 80km according to the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000795623-ebird-rules-and-best-practices\\\"&gt;eBird rules and best practices&lt;/a&gt;, more precise checklists are more valuable for science. It is therefore recommended to keep Traveling checklists under 8 km and Stationary checklists under 3 hours for your sightings to make the biggest impact for science. Limiting your checklists to less than one hour or 1.5 km provides even more checklist precision! Please do not submit one checklist spanning several locations, especially when those locations were separated by long drives. A good rule of thumb is: every time you get in a car, stop the previous list and start a new list at the next location.\n\",\nonly_one_species = \"\nYour checklist(s) was flagged because it is a complete checklist with only a single species. While this might be correct, we wanted to double check with you that birding was indeed your primary purpose and you recorded all the birds around you to the best of your abilities. (Please refer to the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000967748-birding-as-your-primary-purpose-and-complete-checklistss\\\"&gt;eBird support help page&lt;/a&gt; for more information). If not, you can change the protocol to 'Incidental' or mark your list as 'Incomplete'.\n\",\nmulti_day = \"\nYour checklist(s) was flagged because of its unusually high duration. According to the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000795623-ebird-rules-and-best-practices\\\"&gt;eBird rules and best practices&lt;/a&gt;, checklists should &lt;b&gt;correspond to a single calendar date and should not span multiple days&lt;/b&gt;.\n\",\ncomplete_media = \"\nYour checklist(s) was flagged because it is a complete checklist and we suspect that not all birds were reported. While this might be correct, we wanted to double check whether birding was indeed your primary purpose and that you have recorded all the birds around you to the best of your abilities. (Please refer to the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000967748-birding-as-your-primary-purpose-and-complete-checklistss\\\"&gt;eBird support help page&lt;/a&gt; for more information). If not, you can change the protocol to 'Incidental' or mark your list as 'Incomplete'. \n\",\nsame_count_all_species = \"\nYour checklist(s) was flagged because all species were recorded with the same count. We wanted to double check with you that these counts are indeed correct (see more on &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000838845\\\"&gt;how to count birds with eBird&lt;/a&gt;). If you did not count the birds, you can udpate the count to \\\"X\\\".\n\",\nnot_stationary = \"\nYour checklist(s) was flagged because we suspect that the stationary protocol might not be adequate. Can you check the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols#anchorStationary\\\"&gt;guide to eBird protocol&lt;/a&gt; and adjust the protocol if necessary? If you're unable to estimate the distance covered, the Historical protocol would be a good choice. \n\",\nnot_traveling = \"\nYour checklist(s) was flagged because it has a traveling protocol with a distance smaller than 30m. According to &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols#anchorTraveling\\\"&gt;the guide to eBird protocols&lt;/a&gt;, checklists with a distance smaller than 30m should be set as Stationary.\n\",\ntoo_fast = \"\nYour checklist(s) was flagged because we suspect a potential issue with the distance and duration entered. Could you double check the values entered and verify the validity of the protocol selected according to the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000795623-ebird-rules-and-best-practices\\\"&gt;eBird rules and best practices&lt;/a&gt;?\n\",\ntoo_short_duration = \"\nYour checklist(s) was flagged because we suspect a potential issue with the duration entered. Could you double check the value entered and verify the validity of the protocol selected according to the &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000795623-ebird-rules-and-best-practices\\\"&gt;eBird rules and best practices&lt;/a&gt;?\n\",\ntoo_many_observers = \"\nYour checklist(s) was flagged because of the high number of observers. Maybe there is an error in this number?\n\",\nspecialized_protocol = \"\nYour checklist(s) was flagged because it uses a specialized protocol. Please make sure the use of the protocol is appropriate according to &lt;a href=\\\"https://support.ebird.org/en/support/solutions/articles/48000950859-guide-to-ebird-protocols#anchorSpecialized\\\"&gt;eBird guide to protocols&lt;/a&gt;.\"\n)\n\n\nEmail per check\n\nchk_names &lt;- chk %&gt;% select(starts_with(\"chk_\")) %&gt;% names()\n\nfor (chk_i in chk_names){\n  email &lt;- chk %&gt;% \n  filter(!!sym(chk_i)) %&gt;% \n  group_by(observer_id) %&gt;%\n    summarise(checklists_link = paste(checklist_link, collapse = \", \"), number_checklist = n()) %&gt;% \n    arrange(desc(number_checklist)) %&gt;% \n    glue_data(paste0(template$a, template$checklist, template[[gsub(\"chk_\", \"\",chk_i)]], template$z), .sep = \"\\n----\\n\")\n  \n  fileConn&lt;-file(paste0(\"email/\", gsub(\"chk_\", \"\",chk_i), \".txt\"))\n  writeLines(email, fileConn)\n  close(fileConn)\n}\n\n\n\nCombined\n\nobserver &lt;- chk_combined &lt;- chk %&gt;% \n  filter(rowSums(select(., starts_with(\"chk_\"))) &gt; 0) %&gt;% \n  group_by(observer_id) %&gt;%\n  arrange(desc(n())) %&gt;% \n  pull(observer_id) %&gt;% \n  unique()\n\nemail &lt;- \"\"\n\nchk_names &lt;- chk %&gt;% select(starts_with(\"chk_\"), -c(chk_midnight, chk_ampm) ) %&gt;% names()\n\nfor (obs_i in observer){\n  chk_obs &lt;- chk %&gt;% \n    filter(observer_id == obs_i)\n  \n  email &lt;- paste0(email, template$a , \"We performed some automatic checks and the following checklists were identified as having potential issues with protocols. We detail below for each of them what might be incorrect and how to fix them.\n\\n\")\n  \n  for (chk_i in chk_names){\n    checklist_link &lt;- chk_obs %&gt;% \n    filter(!!sym(chk_i)) %&gt;% \n      pull(checklist_link) %&gt;% \n      paste(collapse = \", \")\n    \n    if (checklist_link != \"\"){\n      email &lt;- paste0(email, \n                      \"&lt;b&gt;\", gsub(\"\\\\b([a-z])\", \"\\\\U\\\\1\", gsub(\"_\", \" \", gsub(\"chk_\", \"\",chk_i)), perl=TRUE) , \"&lt;/b&gt;: \",\n                      checklist_link, \n                      template[[gsub(\"chk_\", \"\",chk_i)]],\n                      \"\\n\")\n      \n    }\n  }\n  email &lt;- paste0(email, \"\\nBest wishes,\\n----\\n\")\n}\n\n\n\nfileConn&lt;-file(paste0(\"email/combined_per_observer.txt\"))\n  writeLines(email, fileConn)\n  close(fileConn)"
  }
]